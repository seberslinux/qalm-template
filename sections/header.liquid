<div class="relative">
  {% if section.settings.show_announcement %}
    <div class="bg-black text-white py-2 text-center text-sm">
      <div class="container mx-auto px-4">
        {{ section.settings.announcement_text }}
      </div>
    </div>
  {% endif %}

  <header class="sticky top-0 z-50 bg-white border-b border-gray-100">
    <div class="container mx-auto px-4 py-4 md:px-6">
      <div class="flex items-center justify-between">
        <!-- Mobile Menu Button -->
        <button class="md:hidden js-menu-toggle" aria-label="Menu" aria-expanded="false">
          {% render 'icon-menu' %}
        </button>

        <!-- Logo -->
        <div class="flex-1 md:flex-none text-center md:text-left">
          <a href="/" class="inline-block">
            {% if section.settings.logo != blank %}
              <img src="{{ section.settings.logo | img_url: 'master' }}" 
                   alt="{{ shop.name }}" 
                   width="{{ section.settings.logo_width }}" 
                   class="h-10 w-auto">
            {% else %}
              <span class="text-xl font-bold">{{ shop.name }}</span>
            {% endif %}
          </a>
        </div>

        <!-- Desktop Navigation -->
        <nav class="hidden md:flex items-center space-x-8">
          {% for link in linklists[section.settings.menu].links %}
            <a href="{{ link.url }}" 
               class="text-gray-600 hover:text-black transition-colors text-sm">
              {{ link.title }}
            </a>
          {% endfor %}
        </nav>

        <!-- Icons -->
        <div class="flex items-center space-x-4">
          {% if section.settings.show_search %}
            <a href="{{ routes.search_url }}" 
               class="text-gray-600 hover:text-black transition-colors" 
               aria-label="Search">
              {% render 'icon-search' %}
            </a>
          {% endif %}

          {% if section.settings.show_account %}
            <a href="{{ routes.account_url }}" 
               class="text-gray-600 hover:text-black transition-colors" 
               aria-label="Account">
              {% render 'icon-account' %}
            </a>
          {% endif %}

          <a href="{{ routes.cart_url }}" 
             class="text-gray-600 hover:text-black transition-colors relative js-cart-icon" 
             aria-label="Cart">
            {% render 'icon-cart' %}
            <span class="absolute -top-1 -right-1 bg-black text-white text-xs w-4 h-4 flex items-center justify-center rounded-full">
              {{ cart.item_count }}
            </span>
          </a>
        </div>
      </div>

      <!-- Mobile Menu (hidden by default) -->
      <div class="mobile-menu hidden md:hidden pt-4 pb-3">
        <nav class="flex flex-col space-y-3">
          {% for link in linklists[section.settings.menu].links %}
            <a href="{{ link.url }}" 
               class="text-gray-600 hover:text-black transition-colors">
              {{ link.title }}
            </a>
          {% endfor %}
        </nav>
      </div>
    </div>
  </header>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const menuToggle = document.querySelector('.js-menu-toggle');
    const mobileMenu = document.querySelector('.mobile-menu');
    
    if (menuToggle && mobileMenu) {
      menuToggle.addEventListener('click', function() {
        mobileMenu.classList.toggle('hidden');
        const expanded = menuToggle.getAttribute('aria-expanded') === 'true' || false;
        menuToggle.setAttribute('aria-expanded', !expanded);
        
        // Change icon based on menu state
        if (!expanded) {
          menuToggle.innerHTML = '{% render "icon-close" %}';
        } else {
          menuToggle.innerHTML = '{% render "icon-menu" %}';
        }
      });
    }

    // Update cart count when items are added/removed
    document.addEventListener('cart:updated', function(event) {
      const cartCountElement = document.querySelector('.js-cart-icon span');
      if (cartCountElement) {
        cartCountElement.textContent = event.detail.cart.item_count;
      }
    });
  });
</script>

{% schema %}
{
  "name": "Header",
  "settings": [
    {
      "type": "checkbox",
      "id": "show_announcement",
      "label": "Show announcement bar",
      "default": false
    },
    {
      "type": "text",
      "id": "announcement_text",
      "label": "Announcement text",
      "default": "Free shipping on all orders over $100"
    },
    {
      "type": "image_picker",
      "id": "logo",
      "label": "Logo"
    },
    {
      "type": "range",
      "id": "logo_width",
      "min": 50,
      "max": 250,
      "step": 10,
      "default": 100,
      "unit": "px",
      "label": "Logo width"
    },
    {
      "type": "link_list",
      "id": "menu",
      "label": "Menu",
      "default": "main-menu"
    },
    {
      "type": "checkbox",
      "id": "show_search",
      "label": "Show search",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_account",
      "label": "Show account",
      "default": true
    }
  ],
  "presets": [
    {
      "name": "Header",
      "category": "Header"
    }
  ]
}
{% endschema %}