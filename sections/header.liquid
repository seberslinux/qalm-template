{% schema %}
{
  "name": "Header",
  "settings": [
    {
      "type": "image_picker",
      "id": "logo",
      "label": "Logo"
    },
    {
      "type": "range",
      "id": "logo_width",
      "min": 50,
      "max": 250,
      "step": 10,
      "unit": "px",
      "label": "Logo width",
      "default": 100
    },
    {
      "type": "link_list",
      "id": "menu",
      "label": "Menu",
      "default": "main-menu"
    },
    {
      "type": "checkbox",
      "id": "show_search",
      "label": "Show search",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "sticky_header",
      "label": "Sticky header",
      "default": true
    }
  ]
}
{% endschema %}

<header class="{% if section.settings.sticky_header %}sticky top-0{% endif %} z-50 bg-white border-b border-gray-100">
  <div class="container mx-auto px-4 py-4 md:px-6">
    <div class="flex items-center justify-between">
      <!-- Mobile Menu Button -->
      <button id="mobile-menu-toggle" class="md:hidden" aria-label="Open menu">
        {% render 'icon-menu' %}
      </button>

      <!-- Logo -->
      <div class="flex-1 md:flex-none text-center md:text-left">
        <a href="/" class="inline-block">
          {% if section.settings.logo != blank %}
            {{ section.settings.logo | image_url: width: section.settings.logo_width | image_tag: class: 'h-10 w-auto', alt: shop.name, width: section.settings.logo_width }}
          {% else %}
            <span class="text-xl font-bold">{{ shop.name }}</span>
          {% endif %}
        </a>
      </div>

      <!-- Desktop Navigation -->
      <nav class="hidden md:flex items-center space-x-8">
        {% for link in section.settings.menu.links %}
          <a href="{{ link.url }}" class="text-gray-600 hover:text-black transition-colors text-sm">
            {{ link.title }}
          </a>
        {% endfor %}
      </nav>

      <!-- Icons -->
      <div class="flex items-center space-x-4">
        {% if section.settings.show_search %}
          <button aria-label="Search" class="text-gray-600 hover:text-black transition-colors" id="search-toggle">
            {% render 'icon-search' %}
          </button>
        {% endif %}
        <a href="/account" class="text-gray-600 hover:text-black transition-colors" aria-label="Account">
          {% render 'icon-account' %}
        </a>
        <a href="/cart" class="text-gray-600 hover:text-black transition-colors relative" aria-label="Cart">
          {% render 'icon-cart' %}
          <span class="absolute -top-1 -right-1 bg-black text-white text-xs w-4 h-4 flex items-center justify-center rounded-full">
            {{ cart.item_count }}
          </span>
        </a>
      </div>
    </div>

    <!-- Mobile Menu -->
    <div id="mobile-menu" class="md:hidden pt-4 pb-3 hidden">
      <nav class="flex flex-col space-y-3">
        {% for link in section.settings.menu.links %}
          <a href="{{ link.url }}" class="text-gray-600 hover:text-black transition-colors">
            {{ link.title }}
          </a>
        {% endfor %}
      </nav>
    </div>

    <!-- Search Form -->
    <div id="search-container" class="hidden pt-4">
      <form action="/search" method="get" class="relative">
        <input type="search" 
               name="q" 
               placeholder="Search..." 
               class="w-full px-4 py-2 border border-gray-300 focus:border-black focus:outline-none">
        <button type="submit" class="absolute right-3 top-1/2 transform -translate-y-1/2">
          {% render 'icon-search' %}
        </button>
      </form>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const mobileMenuToggle = document.getElementById('mobile-menu-toggle');
      const mobileMenu = document.getElementById('mobile-menu');
      const searchToggle = document.getElementById('search-toggle');
      const searchContainer = document.getElementById('search-container');

      if (mobileMenuToggle && mobileMenu) {
        mobileMenuToggle.addEventListener('click', function() {
          mobileMenu.classList.toggle('hidden');
          mobileMenuToggle.setAttribute('aria-label', mobileMenu.classList.contains('hidden') ? 'Open menu' : 'Close menu');
          mobileMenuToggle.innerHTML = mobileMenu.classList.contains('hidden') ? `{% render 'icon-menu' %}` : `{% render 'icon-close' %}`;
        });
      }

      if (searchToggle && searchContainer) {
        searchToggle.addEventListener('click', function() {
          searchContainer.classList.toggle('hidden');
        });
      }
    });
  </script>
</header>