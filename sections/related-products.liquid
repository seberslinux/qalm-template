{% schema %}
{
  "name": "Related products",
  "tag": "section",
  "class": "related-products py-16 bg-gray-50",
  "settings": [
    {
      "type": "text",
      "id": "title",
      "label": "Heading",
      "default": "You may also like"
    },
    {
      "type": "checkbox",
      "id": "show_vendor",
      "label": "Show vendor",
      "default": false
    },
    {
      "type": "range",
      "id": "products_to_show",
      "min": 2,
      "max": 8,
      "step": 1,
      "default": 4,
      "label": "Products to show"
    },
    {
      "type": "select",
      "id": "columns_desktop",
      "label": "Desktop columns",
      "options": [
        {
          "value": "2",
          "label": "2 columns"
        },
        {
          "value": "3",
          "label": "3 columns"
        },
        {
          "value": "4",
          "label": "4 columns"
        }
      ],
      "default": "4"
    },
    {
      "type": "checkbox",
      "id": "show_color_swatches",
      "label": "Show color swatches",
      "default": true
    }
  ]
}
{% endschema %}

<div class="container mx-auto px-4 md:px-6">
  <h2 class="text-3xl font-light text-center mb-8">{{ section.settings.title }}</h2>
  
  <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-{{ section.settings.columns_desktop }} gap-8">
    {% assign related_products = recommendations.products | slice: 0, section.settings.products_to_show %}
    
    {% if related_products.size == 0 %}
      {% assign related_products = collections.all.products | where: "type", product.type | limit: section.settings.products_to_show %}
    {% endif %}
    
    {% if related_products.size == 0 %}
      {% assign related_products = collections.all.products | limit: section.settings.products_to_show %}
    {% endif %}
    
    {% for related_product in related_products %}
      {% if related_product.id != product.id %}
        {% render 'product-card', product: related_product, show_vendor: section.settings.show_vendor, show_colors: section.settings.show_color_swatches %}
      {% endif %}
    {% endfor %}
  </div>
</div>